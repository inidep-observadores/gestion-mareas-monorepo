generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id               String               @id @default(uuid()) @db.Uuid
  email            String               @unique
  password         String
  fullName         String
  isActive         Boolean              @default(true)
  roles            String[]             @default(["invitado"])
  themePreference  String               @default("system")
  avatarUrl        String?
  alertasAsignadas Alerta[]             @relation("AlertaAsignado")
  alertasCreadas   Alerta[]             @relation("AlertaCreadoPor")
  eventosAlerta    AlertaEvento[]
  archivos         MareaArchivo[]
  movimientos      MareaMovimiento[]
  resetTokens      PasswordResetToken[]
  products         Product[]

  @@map("users")
}

model PasswordResetToken {
  id          String   @id @default(uuid()) @db.Uuid
  token       String
  expiresAt   DateTime @map("expires_at") @db.Timestamptz(6)
  used        Boolean  @default(false)
  requestedIp String?  @map("requested_ip")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  userId      String   @map("user_id") @db.Uuid
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("password_reset_tokens")
}

model Product {
  id          String         @id @default(uuid()) @db.Uuid
  title       String         @unique
  price       Float          @default(0)
  description String?
  slug        String         @unique
  stock       Int            @default(0)
  sizes       String[]
  gender      String
  tags        String[]       @default([])
  userId      String         @db.Uuid
  images      ProductImage[]
  user        User           @relation(fields: [userId], references: [id])

  @@map("products")
}

model ProductImage {
  id        Int     @id @default(autoincrement())
  url       String
  productId String  @db.Uuid
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_images")
}

model TipoFlota {
  id              String  @id @default(uuid()) @db.Uuid
  codigo          String  @unique
  nombre          String
  descripcion     String?
  orden           Int?
  activo          Boolean @default(true)
  codigo_numerico Int     @unique @map("codigo_numerico")
  buques          Buque[]

  @@map("tipos_flota")
}

model Buque {
  id                      String                  @id @default(uuid()) @db.Uuid
  nombreBuque             String                  @map("nombre_buque")
  matricula               String                  @unique
  codigoInterno           Int?                    @map("codigo_interno")
  tipoFlotaId             String?                 @map("id_tipo_flota") @db.Uuid
  arteHabitualId          String?                 @map("id_arte_habitual") @db.Uuid
  pesqueriaHabitualId     String?                 @map("id_pesqueria_habitual") @db.Uuid
  diasMareaEstimada       Int?                    @map("dias_marea_estimada")
  esloraM                 Decimal?                @map("eslora_m") @db.Decimal(6, 2)
  potenciaHp              Int?                    @map("potencia_hp")
  puertoBaseId            String?                 @map("id_puerto_base") @db.Uuid
  empresaNombre           String?                 @map("empresa_nombre")
  empresaLocalidad        String?                 @map("empresa_localidad")
  empresaTelefono         String?                 @map("empresa_telefono")
  empresaFax              String?                 @map("empresa_fax")
  empresaCorreoPrincipal  String?                 @map("empresa_correo_principal")
  empresaCorreoSecundario String?                 @map("empresa_correo_secundario")
  armadorNombre           String?                 @map("armador_nombre")
  armadorTelefono         String?                 @map("armador_telefono")
  agenciaMaritimaNombre   String?                 @map("agencia_maritima_nombre")
  activo                  Boolean                 @default(true)
  fechaAlta               DateTime?               @map("fecha_alta") @db.Date
  fechaBaja               DateTime?               @map("fecha_baja") @db.Date
  observaciones           String?
  puntosTrayectoria       BuqueTrayectoriaPunto[]
  trayectorias            BuqueTrayectoria?
  arteHabitual            ArtePesca?              @relation(fields: [arteHabitualId], references: [id])
  pesqueriaHabitual       Pesqueria?              @relation(fields: [pesqueriaHabitualId], references: [id])
  puertoBase              Puerto?                 @relation(fields: [puertoBaseId], references: [id])
  tipoFlota               TipoFlota?              @relation(fields: [tipoFlotaId], references: [id])
  mareas                  Marea[]

  @@map("buques")
}

model ArtePesca {
  id               String  @id @default(uuid()) @db.Uuid
  codigoNumerico   Int     @unique @map("codigo_numerico")
  activo           Boolean @default(true)
  nombre           String
  buquesHabituales Buque[]
  lances           Lance[]
  mareas           Marea[]

  @@map("artes_pesca")
}

model Pesqueria {
  id                     String                @id @default(uuid()) @db.Uuid
  codigo                 String                @unique
  nombre                 String
  descripcion            String?
  grupo                  String?
  orden                  Int?
  activo                 Boolean               @default(true)
  buquesHabituales       Buque[]
  etapasMarea            MareaEtapa[]
  observadoresPesquerias ObservadorPesqueria[]

  @@map("pesquerias")
}

model Puerto {
  id            String       @id @default(uuid()) @db.Uuid
  nombre        String
  provincia     String?
  pais          String?
  codigoInterno String?      @unique @map("codigo_interno")
  codigoExterno String?      @map("codigo_externo")
  esLocal       Boolean      @default(false) @map("es_local")
  activo        Boolean      @default(true)
  orden         Int?
  observaciones String?
  latitud       Float?
  longitud      Float?
  buquesBase    Buque[]
  etapasArribo  MareaEtapa[] @relation("PuertoArribo")
  etapasZarpada MareaEtapa[] @relation("PuertoZarpada")

  @@map("puertos")
}

model Especie {
  id                     String                @id @default(uuid()) @db.Uuid
  codigo                 String                @unique
  nombreCientifico       String                @map("nombre_cientifico")
  nombreVulgar           String                @map("nombre_vulgar")
  activo                 Boolean               @default(true)
  observaciones          String?
  capturas               Captura[]
  muestras               Muestra[]
  observadoresPesquerias ObservadorPesqueria[]
  producciones           Produccion[]

  @@map("especies")
}

model Observador {
  id                         String                 @id @default(uuid()) @db.Uuid
  codigoInterno              Int                    @unique @map("codigo_interno")
  nombre                     String
  apellido                   String
  fotoUrl                    String?                @map("foto_url")
  tipoObservador             String                 @map("tipo_observador")
  tipoContrato               String                 @map("tipo_contrato")
  activo                     Boolean                @default(true)
  disponible                 Boolean                @default(true)
  fechaProximaDisponibilidad DateTime?              @map("fecha_proxima_disponibilidad") @db.Timestamptz(6)
  observaciones              String?
  conImpedimento             Boolean                @default(false) @map("con_impedimento")
  email                      String?                @unique
  motivoImpedimento          String?                @map("motivo_impedimento")
  etapas                     MareaEtapaObservador[]
  pesquerias                 ObservadorPesqueria[]

  @@map("observadores")
}

model ObservadorPesqueria {
  id           String     @id @default(uuid()) @db.Uuid
  observadorId String     @map("id_observador") @db.Uuid
  pesqueriaId  String     @map("id_pesqueria") @db.Uuid
  modo         String
  activo       Boolean    @default(true)
  motivo       String?
  fechaDesde   DateTime?  @map("fecha_desde") @db.Timestamptz(6)
  fechaHasta   DateTime?  @map("fecha_hasta") @db.Timestamptz(6)
  especieId    String     @map("id_especie") @db.Uuid
  especie      Especie    @relation(fields: [especieId], references: [id])
  observador   Observador @relation(fields: [observadorId], references: [id])
  pesqueria    Pesqueria  @relation(fields: [pesqueriaId], references: [id])

  @@unique([observadorId, pesqueriaId, modo])
  @@index([observadorId])
  @@index([pesqueriaId])
  @@map("observador_pesquerias")
}

model Marea {
  id                       String            @id @default(uuid()) @db.Uuid
  anioMarea                Int               @map("anio_marea")
  nroMarea                 Int               @map("nro_marea")
  buqueId                  String            @map("id_buque") @db.Uuid
  artePrincipalId          String?           @map("id_arte_principal") @db.Uuid
  estadoActualId           String            @map("id_estado_actual") @db.Uuid
  fechaZarpadaEstimada     DateTime?         @map("fecha_zarpada_estimada") @db.Timestamptz(6)
  fechaInicioObservador    DateTime?         @map("fecha_inicio_observador") @db.Timestamptz(6)
  fechaFinObservador       DateTime?         @map("fecha_fin_observador") @db.Timestamptz(6)
  diasZonaAustral          Int?              @map("dias_zona_austral")
  tipoCalculoZonaAustral   String            @default("AUTOMATICO") @map("tipo_calculo_zona_austral")
  nroProtocolizacion       Int?              @map("nro_protocolizacion")
  anioProtocolizacion      Int?              @map("anio_protocolizacion")
  fechaProtocolizacion     DateTime?         @map("fecha_protocolizacion") @db.Timestamptz(6)
  fechaCreacion            DateTime          @default(now()) @map("fecha_creacion") @db.Timestamptz(6)
  fechaUltimaActualizacion DateTime          @updatedAt @map("fecha_ultima_actualizacion") @db.Timestamptz(6)
  activo                   Boolean           @default(true)
  observaciones            String?
  tipoMarea                String            @default("MC") @map("tipo_marea")
  diasEstimados            Int?              @map("dias_estimados")
  artePrincipal            ArtePesca?        @relation(fields: [artePrincipalId], references: [id])
  buque                    Buque             @relation(fields: [buqueId], references: [id])
  estadoActual             EstadoMarea       @relation(fields: [estadoActualId], references: [id])
  archivos                 MareaArchivo[]
  etapas                   MareaEtapa[]
  movimientos              MareaMovimiento[]
  producciones             Produccion[]

  @@unique([anioMarea, nroMarea, buqueId, tipoMarea], name: "identificadorMarea")
  @@map("mareas")
}

model MareaEtapa {
  id              String                 @id @default(uuid()) @db.Uuid
  mareaId         String                 @map("id_marea") @db.Uuid
  nroEtapa        Int                    @map("nro_etapa")
  pesqueriaId     String?                @map("id_pesqueria") @db.Uuid
  puertoZarpadaId String?                @map("id_puerto_zarpada") @db.Uuid
  puertoArriboId  String?                @map("id_puerto_arribo") @db.Uuid
  fechaZarpada    DateTime?              @map("fecha_zarpada") @db.Timestamptz(6)
  fechaArribo     DateTime?              @map("fecha_arribo") @db.Timestamptz(6)
  tipoEtapa       String                 @map("tipo_etapa")
  observaciones   String?
  lances          Lance[]
  marea           Marea                  @relation(fields: [mareaId], references: [id])
  pesqueria       Pesqueria?             @relation(fields: [pesqueriaId], references: [id])
  puertoArribo    Puerto?                @relation("PuertoArribo", fields: [puertoArriboId], references: [id])
  puertoZarpada   Puerto?                @relation("PuertoZarpada", fields: [puertoZarpadaId], references: [id])
  observadores    MareaEtapaObservador[]

  @@unique([mareaId, nroEtapa])
  @@index([mareaId])
  @@map("mareas_etapas")
}

model MareaEtapaObservador {
  id           String     @id @default(uuid()) @db.Uuid
  etapaId      String     @map("id_etapa") @db.Uuid
  observadorId String     @map("id_observador") @db.Uuid
  rol          String     @default("PRINCIPAL")
  esDesignado  Boolean    @default(true) @map("es_designado")
  etapa        MareaEtapa @relation(fields: [etapaId], references: [id])
  observador   Observador @relation(fields: [observadorId], references: [id])

  @@unique([etapaId, observadorId])
  @@index([etapaId])
  @@index([observadorId])
  @@map("mareas_etapas_observadores")
}

model MareaMovimiento {
  id                       String         @id @default(uuid()) @db.Uuid
  mareaId                  String         @map("id_marea") @db.Uuid
  fechaHora                DateTime       @map("fecha_hora") @db.Timestamptz(6)
  usuarioId                String?        @map("id_usuario") @db.Uuid
  tipoEvento               String         @map("tipo_evento")
  estadoDesdeId            String?        @map("id_estado_desde") @db.Uuid
  estadoHastaId            String?        @map("id_estado_hasta") @db.Uuid
  cantidadMuestrasOtolitos Int?           @map("cantidad_muestras_otolitos")
  detalle                  String?
  comentarios              String?
  archivos                 MareaArchivo[]
  estadoDesde              EstadoMarea?   @relation("EstadoDesde", fields: [estadoDesdeId], references: [id])
  estadoHasta              EstadoMarea?   @relation("EstadoHasta", fields: [estadoHastaId], references: [id])
  marea                    Marea          @relation(fields: [mareaId], references: [id])
  usuario                  User?          @relation(fields: [usuarioId], references: [id])

  @@index([mareaId])
  @@map("mareas_movimientos")
}

model MareaArchivo {
  id                 String           @id @default(uuid()) @db.Uuid
  mareaId            String           @map("id_marea") @db.Uuid
  movimientoOrigenId String?          @map("id_movimiento_origen") @db.Uuid
  tipoArchivo        String           @map("tipo_archivo")
  formato            String?
  version            String?
  rutaArchivo        String           @map("ruta_archivo")
  fechaSubida        DateTime         @default(now()) @map("fecha_subida") @db.Timestamptz(6)
  usuarioSubioId     String?          @map("id_usuario_subio") @db.Uuid
  descripcion        String?
  marea              Marea            @relation(fields: [mareaId], references: [id])
  movimientoOrigen   MareaMovimiento? @relation(fields: [movimientoOrigenId], references: [id])
  usuarioSubio       User?            @relation(fields: [usuarioSubioId], references: [id])

  @@index([mareaId])
  @@map("mareas_archivos")
}

model Lance {
  id                 String     @id @default(uuid()) @db.Uuid
  etapaId            String     @map("etapa_id") @db.Uuid
  numeroLance        Int        @map("numero_lance")
  fecha              DateTime   @db.Date
  codArtePesca       Int        @map("cod_arte_pesca")
  tipoArtePesca      Int?       @map("tipo_arte_pesca")
  horaInicio         Float?     @map("hora_inicio")
  latInicio          Float?     @map("lat_inicio")
  longInicio         Float?     @map("long_inicio")
  profInicio         Int?       @map("prof_inicio")
  horaFinal          Float?     @map("hora_final")
  latFinal           Float?     @map("lat_final")
  longFinal          Float?     @map("long_final")
  profFinal          Int?       @map("prof_final")
  rumbo              Int?
  distanciaRed       Float?     @map("distancia_red")
  velocidadArrastre  Float?     @map("velocidad_arrastre")
  tiempoRed          Int?       @map("tiempo_red")
  estacionGral       Int?       @map("estacion_gral")
  calador            String?
  fondoMin           Int?       @map("fondo_min")
  fondoMax           Int?       @map("fondo_max")
  tamiz              String?
  areaBarrida        Float?     @map("area_barrida")
  capturaTotalKg     Float?     @map("captura_total_kg")
  descarteTotalKg    Float?     @map("descarte_total_kg")
  observacionesLance String?    @map("observaciones_lance")
  mus                Int?
  fuenteDato         Int?       @map("fuente_dato")
  capturas           Captura[]
  artePesca          ArtePesca  @relation(fields: [codArtePesca], references: [codigoNumerico])
  etapa              MareaEtapa @relation(fields: [etapaId], references: [id])
  muestras           Muestra[]

  @@unique([etapaId, numeroLance])
  @@index([etapaId])
  @@map("lances")
}

model Captura {
  id                   String  @id @default(uuid()) @db.Uuid
  lanceId              String  @map("lance_id") @db.Uuid
  especieId            String  @map("especie_id") @db.Uuid
  kgCaptura            Float   @map("kg_captura")
  kgDescarte           Float   @map("kg_descarte")
  observacionesCaptura String? @map("observaciones_captura")
  indiceOriginal       Int     @map("indice_original")
  especie              Especie @relation(fields: [especieId], references: [id])
  lance                Lance   @relation(fields: [lanceId], references: [id])

  @@unique([lanceId, especieId])
  @@index([lanceId])
  @@map("capturas")
}

model Muestra {
  id              String                @id @default(uuid()) @db.Uuid
  lanceId         String                @map("lance_id") @db.Uuid
  especieId       String                @map("especie_id") @db.Uuid
  tipoMuestra     String                @map("tipo_muestra")
  pesoMuestraKg   Float?                @map("peso_muestra_kg")
  factPonderacion Float?                @map("fact_ponderacion")
  unidadLargo     String                @map("unidad_largo")
  primeraTalla    Int?                  @map("primera_talla")
  ultimaTalla     Int?                  @map("ultima_talla")
  intervaloMm     Int?                  @map("intervalo_mm")
  totalMediciones Int?                  @map("total_mediciones")
  observaciones   String?
  especie         Especie               @relation(fields: [especieId], references: [id])
  lance           Lance                 @relation(fields: [lanceId], references: [id])
  detallesTalla   MuestraDetalleTalla[]
  submuestras     Submuestra[]

  @@unique([lanceId, especieId, tipoMuestra])
  @@index([lanceId])
  @@map("muestras")
}

model MuestraDetalleTalla {
  id              String  @id @default(uuid()) @db.Uuid
  muestraId       String  @map("muestra_id") @db.Uuid
  tallaMm         Int     @map("talla_mm")
  cantidadMachos  Int     @map("cantidad_machos")
  cantidadHembras Int     @map("cantidad_hembras")
  cantidadIndet   Int     @map("cantidad_indet")
  cantidadTotal   Int     @map("cantidad_total")
  indiceOriginal  Int     @map("indice_original")
  muestra         Muestra @relation(fields: [muestraId], references: [id])

  @@unique([muestraId, tallaMm])
  @@index([muestraId])
  @@map("muestras_detalle_talla")
}

model Submuestra {
  id                    String  @id @default(uuid()) @db.Uuid
  muestraId             String  @map("muestra_id") @db.Uuid
  numeroEjemplar        Int     @map("numero_ejemplar")
  largoTotal            Int?    @map("largo_total")
  largoEstandar         Int?    @map("largo_estandar")
  pesoTotalG            Float?  @map("peso_total_g")
  pesoGonadasG          Float?  @map("peso_gonadas_g")
  sexo                  Int?
  estadioMadurez        Int?    @map("estadio_madurez")
  replecion             Int?
  contenidoEstomacal    String? @map("contenido_estomacal")
  observacionesEjemplar String? @map("observaciones_ejemplar")
  muestra               Muestra @relation(fields: [muestraId], references: [id])

  @@unique([muestraId, numeroEjemplar])
  @@index([muestraId])
  @@map("submuestras")
}

model Produccion {
  id               String   @id @default(uuid()) @db.Uuid
  mareaId          String   @map("marea_id") @db.Uuid
  especieId        String   @map("especie_id") @db.Uuid
  fecha            DateTime @db.Date
  producto         String?
  categoria        String?
  factorConversion Float?   @map("factor_conversion")
  kgProduccion     Float    @map("kg_produccion")
  operarios        Int?
  especie          Especie  @relation(fields: [especieId], references: [id])
  marea            Marea    @relation(fields: [mareaId], references: [id])

  @@unique([mareaId, especieId, fecha, producto, categoria])
  @@index([mareaId])
  @@map("producciones")
}

model BuqueTrayectoria {
  id       String                  @id @default(uuid()) @db.Uuid
  buqueId  String                  @unique @map("buque_id") @db.Uuid
  origen   String?
  metadata Json?
  puntos   BuqueTrayectoriaPunto[]
  buque    Buque                   @relation(fields: [buqueId], references: [id])

  @@index([buqueId])
  @@map("buque_trayectorias")
}

model BuqueTrayectoriaPunto {
  id            String           @id @default(uuid()) @db.Uuid
  trayectoriaId String           @map("trayectoria_id") @db.Uuid
  buqueId       String           @map("buque_id") @db.Uuid
  timestamp     DateTime         @db.Timestamptz(6)
  lat           Float
  lon           Float
  velocidad     Float?
  rumbo         Int?
  buque         Buque            @relation(fields: [buqueId], references: [id])
  trayectoria   BuqueTrayectoria @relation(fields: [trayectoriaId], references: [id])

  @@unique([buqueId, timestamp])
  @@index([trayectoriaId, timestamp])
  @@index([buqueId, timestamp])
  @@map("buque_trayectoria_puntos")
}

model EstadoMarea {
  id                   String             @id @default(uuid()) @db.Uuid
  codigo               String             @unique
  nombre               String
  descripcion          String?
  categoria            String
  orden                Int
  esInicial            Boolean            @default(false) @map("es_inicial")
  esFinal              Boolean            @default(false) @map("es_final")
  permiteCargaArchivos Boolean            @default(false) @map("permite_carga_archivos")
  permiteCorreccion    Boolean            @default(false) @map("permite_correccion")
  permiteInforme       Boolean            @default(false) @map("permite_informe")
  activo               Boolean            @default(true)
  mostrarEnPanel       Boolean            @default(false) @map("mostrar_en_panel")
  mareas               Marea[]
  movimientosDesde     MareaMovimiento[]  @relation("EstadoDesde")
  movimientosHasta     MareaMovimiento[]  @relation("EstadoHasta")
  transicionesHasta    TransicionEstado[] @relation("TransicionEstadoHasta")
  transicionesDesde    TransicionEstado[] @relation("TransicionEstadoDesde")

  @@map("estados_marea")
}

model TransicionEstado {
  id              String      @id @default(uuid()) @db.Uuid
  estadoOrigenId  String      @map("id_estado_origen") @db.Uuid
  estadoDestinoId String      @map("id_estado_destino") @db.Uuid
  accion          String
  etiqueta        String
  claseBoton      String?     @map("clase_boton")
  requiereObs     Boolean     @default(false) @map("requiere_observaciones")
  activo          Boolean     @default(true)
  estadoDestino   EstadoMarea @relation("TransicionEstadoHasta", fields: [estadoDestinoId], references: [id])
  estadoOrigen    EstadoMarea @relation("TransicionEstadoDesde", fields: [estadoOrigenId], references: [id])

  @@unique([estadoOrigenId, estadoDestinoId, accion])
  @@map("transiciones_estados")
}

model ErrorLog {
  id        String   @id @default(uuid()) @db.Uuid
  timestamp DateTime @default(now()) @db.Timestamptz(6)
  level     String
  source    String
  context   String?
  userId    String?  @db.Uuid
  userEmail String?
  message   String
  stack     String?
  detail    Json?
  path      String?
  method    String?
  ip        String?

  @@map("error_logs")
}

model Alerta {
  id                  String         @id @default(uuid()) @db.Uuid
  codigoUnico         String         @unique @map("codigo_unico")
  referenciaId        String?        @map("referencia_id")
  referenciaTipo      String?        @map("referencia_tipo")
  metadata            Json?          @map("metadata")
  tipo                String
  titulo              String
  descripcion         String
  estado              String
  prioridad           String
  fechaDetectada      DateTime       @map("fecha_detectada") @db.Timestamptz(6)
  fechaVencimiento    DateTime?      @map("fecha_vencimiento") @db.Timestamptz(6)
  fechaCierre         DateTime?      @map("fecha_cierre") @db.Timestamptz(6)
  asignadoId          String?        @map("asignado_id") @db.Uuid
  creadoPorId         String?        @map("creado_por_id") @db.Uuid
  ultimaActualizacion DateTime       @updatedAt @map("ultima_actualizacion") @db.Timestamptz(6)
  asignadoA           User?          @relation("AlertaAsignado", fields: [asignadoId], references: [id])
  creadoPor           User?          @relation("AlertaCreadoPor", fields: [creadoPorId], references: [id])
  eventos             AlertaEvento[]

  @@index([referenciaId])
  @@index([estado])
  @@index([asignadoId])
  @@map("alertas")
}

model AlertaEvento {
  id         String   @id @default(uuid()) @db.Uuid
  alertaId   String   @map("alerta_id") @db.Uuid
  fechaHora  DateTime @default(now()) @map("fecha_hora") @db.Timestamptz(6)
  usuarioId  String?  @map("usuario_id") @db.Uuid
  tipoEvento String   @map("tipo_evento")
  detalle    String?
  alerta     Alerta   @relation(fields: [alertaId], references: [id], onDelete: Cascade)
  usuario    User?    @relation(fields: [usuarioId], references: [id])

  @@index([alertaId])
  @@map("alertas_eventos")
}

model ImportacionAccessSnapshot {
  id                   String   @id @default(uuid()) @db.Uuid
  idExterno            Int      @unique @map("id_externo")
  
  // Datos parseados del registro
  nroMarea             Int?     @map("nro_marea")
  anioMarea            Int      @map("anio_marea")
  tipoMarea            String   @map("tipo_marea") // 'MC' o 'CI'
  nroEtapa             Int      @map("nro_etapa")
  
  // Fechas del registro
  fechaZarpada         DateTime? @map("fecha_zarpada") @db.Date
  fechaArribo          DateTime? @map("fecha_arribo") @db.Date
  
  // Datos adicionales para matching
  buqueNombre          String?  @map("buque_nombre")
  observadorCodigo     Int?     @map("observador_codigo")
  
  // Hash del contenido para detección rápida de cambios
  hashContenido        String   @map("hash_contenido")
  
  // Tracking de procesamiento
  fechaPrimeraLectura  DateTime @default(now()) @map("fecha_primera_lectura") @db.Timestamptz(6)
  fechaUltimaLectura   DateTime @updatedAt @map("fecha_ultima_lectura") @db.Timestamptz(6)
  
  // Vinculación opcional con entidades locales
  mareaId              String?  @map("marea_id") @db.Uuid
  etapaId              String?  @map("etapa_id") @db.Uuid

  @@index([nroMarea, anioMarea, tipoMarea])
  @@map("importacion_access_snapshots")
}
